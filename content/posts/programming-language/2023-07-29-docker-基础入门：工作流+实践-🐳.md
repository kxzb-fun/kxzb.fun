---
title: "Docker åŸºç¡€å…¥é—¨ï¼šå·¥ä½œæµ+å®è·µ ğŸ³"
date: "2023-07-29T08:36:31+0000"
tags: ['docker']
---


## ç®€ä»‹

æœ¬é¡¹ç›®é’ˆå¯¹åˆšåˆšæ¥è§¦ Docker çš„æ–°æ‰‹ï¼Œè®²è§£ Docker åŸºæœ¬æ“ä½œï¼Œå¹¶ç»“åˆä¸€ä¸ªå®é™…æ¡ˆä¾‹æ¥è®²è§£å…·ä½“åº”ç”¨ã€‚

## ç¯å¢ƒè¯´æ˜

æ“ä½œç³»ç»Ÿï¼šMacOS Ventura 13.0

## å®‰è£… Docker

é€šè¿‡å®˜æ–¹ç½‘ç«™åœ°å€é€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿè¿›è¡Œå®‰è£…å³å¯ [å®˜æ–¹è¿æ¥](https://docs.docker.com/get-docker/)

### æŸ¥çœ‹ Docker ç‰ˆæœ¬

```bash
docker version
```

å®‰è£…æˆåŠŸä¼šæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼ˆMacOS ç‰ˆï¼‰

```bash
Client:
 Cloud integration: v1.0.35
 Version:   24.0.2
 API version:   1.43
 Go version:go1.20.4
 Git commit:cb74dfc
 Built: Thu May 25 21:51:16 2023
 OS/Arch:   darwin/amd64
 Context:   desktop-linux
Server: Docker Desktop 4.21.1 (114176)
 Engine:
  Version:  24.0.2
  API version:  1.43 (minimum version 1.12)
  Go version:   go1.20.4
  Git commit:   659604f
  Built:Thu May 25 21:52:17 2023
  OS/Arch:  linux/amd64
  Experimental: false
 containerd:
  Version:  1.6.21
  GitCommit:3dce8eb055cbb6872793272b4f20ed16117344f8
 runc:
  Version:  1.1.7
  GitCommit:v1.1.7-0-g860f061
 docker-init:
  Version:  0.19.0
  GitCommit:de40ad0
```

## åˆ›å»ºæœ¬åœ°é¡¹ç›®

### åˆå§‹åŒ–é¡¹ç›®

```bash
mkdir learn-docker
npm init -y
npm install express
```

### å¯åŠ¨ç®€å•çš„æœåŠ¡

åˆ›å»º app.js æ–‡ä»¶

```bash
const express = require("express");
const app = express();
const PORT = 3000;
app.get("/", (req, res) => {
  res.send("<p>å¤§å®¶å¥½å•Šï¼</p>");
});
app.listen(PORT, () => {
  console.log("running at 3000 prot");
});

æ‰§è¡Œ `node app.js` å¯åŠ¨æœåŠ¡ æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨ `http://localhost:3000/` è®¿é—®åˆ°æˆ‘ä»¬çš„å†…å®¹ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨
Docker æ¥å®ç°ã€‚
```

## åˆ›å»º Dockerfile æ–‡ä»¶

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»º Dockerfile æ–‡ä»¶

```bash
FROM node:20-alpine3.17 # è¡¨ç¤ºæˆ‘ä»¬ä½¿ç”¨node 20çš„ç‰ˆæœ¬ æ³¨æ„1
WORKDIR /myDocker # æŒ‡å®šæˆ‘ä»¬çš„å·¥ä½œç›®å½•
COPY package.json . # å°† package.json å¤åˆ¶åˆ°å·¥ä½œç›®å½• .è¡¨ç¤ºæ›´ç›®å½• ä¹Ÿå°±æ˜¯æˆ‘ä»¬æŒ‡å®šçš„å·¥ä½œç›®å½•
RUN npm install # æ‰§è¡Œ package.json
COPY . . # å°†æœ¬åœ°å…¨éƒ¨æ–‡ä»¶æ‹·è´åˆ°Dockerçš„å·¥ä½œç›®å½• æ³¨æ„2
EXPOSE 3000 # æš´éœ²3000ç«¯å£ æ³¨æ„3
CMD ["node","app.js"] # æ‰§è¡Œå¯åŠ¨æœåŠ¡å‘½ä»¤
```

* æ³¨æ„ 1ï¼š Alpine æ“ä½œç³»ç»Ÿæ˜¯ä¸€ä¸ªé¢å‘å®‰å…¨çš„è½»å‹ Linux å‘è¡Œç‰ˆã€‚å®ƒä¸åŒäºé€šå¸¸ Linux å‘è¡Œç‰ˆï¼ŒAlpine é‡‡ç”¨äº† musl libc å’Œ busybox ä»¥å‡å°ç³»ç»Ÿçš„ä½“ç§¯å’Œè¿è¡Œæ—¶èµ„æºæ¶ˆè€—ï¼Œä½†åŠŸèƒ½ä¸Šæ¯” busybox åˆå®Œå–„çš„å¤šï¼Œå› æ­¤å¾—åˆ°å¼€æºç¤¾åŒºè¶Šæ¥è¶Šå¤šçš„é’ç
* æ³¨æ„ 2ï¼šæˆ‘ä»¬è¿™é‡Œéœ€è¦å¿½ç•¥ node_modules ç­‰ä¸€äº›æ–‡ä»¶çš„å¤åˆ¶
* æ³¨æ„ 3ï¼šEXPOSE 3000 åªæœ‰æ–‡æ¡£è¯´æ˜ä½œç”¨ ä¸èµ·ä»»ä½•å®é™…ä½œç”¨ã€‚å®é™…å¼€å¯ 3000 ç«¯å£çš„æ˜¯ app.js çš„å†…å®¹ï¼›è€Œ Dockerfile é‡Œçš„ EXPOSE åªæ˜¯è®©äººä»¬çŸ¥é“è¿™ä¸ªå®¹å™¨ä½¿ç”¨çš„æ˜¯ 3000 ç«¯å£

## åˆ›å»º .dockerignore æ–‡ä»¶

å‰é¢æåˆ°çš„æ³¨æ„ 2 ä¸­çš„äº‹é¡¹ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡ npm install å®‰è£…äº† node_modules ï¼Œæ‰€ä»¥ä¸éœ€è¦å†å¤åˆ¶ä¸€éã€‚

```bash
node_modules
Dockerfile
.dockerignore
.git
.gitignore
```

## æ„å»ºé•œåƒ

é€šè¿‡ä¸Šé¢çš„æ“ä½œæˆ‘ä»¬å°±å¯ä»¥æ¥æ„å»ºé•œåƒäº†ã€‚

```bash
docker build .
```

## æŸ¥çœ‹é•œåƒ

```bash
docker images
```

ä¼šçœ‹åˆ°å¦‚ä¸‹çš„å±•ç¤º

```bash
REPOSITORYTAG   IMAGE ID   CREATED SIZE
nodejs-image  latest227b17a0a994   About an hour ago   189MB
```

## ç»™é•œåƒå–åå­— tag

```bash
docker tag 227 baituzai/nodejs:v1.0
```

* 227 æ˜¯é•œåƒ id çš„å‰ 3 ä½æ•°å­—
* baituzai/nodejs:v1.0 ç”¨æˆ·å/é•œåƒå:ç‰ˆæœ¬

_**æ³¨æ„ï¼šå¦‚æœä¸åŠ ç‰ˆæœ¬å°±æ˜¯ lasted å»ºè®®åŠ¡å¿…åŠ ä¸Š**_

## ç™»å½•å¹¶æ¨é€ Docker Hub

```bash
docker login
# æ ¹æ®æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
# æˆåŠŸç™»å½•åæ‰§è¡Œ
docker push baituzai/nodejs:v1.0
```

## åœ¨æ„å»ºé•œåƒçš„æ—¶å€™å°±å®šä¹‰åå­— å…·åé•œåƒ -t

```bash
docker build -t my_docker_image_name .
```

æ³¨æ„ï¼š. è¡¨ç¤ºç›¸å¯¹åœ°å€

## åˆ é™¤æœ¬åœ°çš„é•œåƒ

å·²ç»å­˜åœ¨äº Docker Hub æ‰€ä»¥æŠŠæœ¬åœ°åˆ é™¤

```bash
docker rmi -f baituzai/nodejs:v1.0
```

* rm remove ç§»é™¤
* i è¡¨ç¤º image é•œåƒ
* f force å¼ºåˆ¶åˆ é™¤ï¼ˆåœ¨ä½¿ç”¨ä¸­çš„é•œåƒä¼šè¢«åˆ é™¤ï¼‰

## æŠŠé•œåƒæ‹‰å–åˆ°æœ¬åœ°

```bash
docker pull baituzai/nodejs:v1.0 # docker pull é•œåƒåç§°
```

## è¿è¡Œé•œåƒ

```bash
docker run nodejs-image # docker run é•œåƒåç§°
```

è¿™ç§æ–¹å¼ä¼šå ç”¨æˆ‘ä»¬çš„å½“å‰å‘½ä»¤è¡Œçª—å£ï¼Œä½¿ç”¨ -d é€‰é¡¹ä½¿å®¹å™¨åœ¨åå°è¿è¡Œ

```bash
docker run -d nodejs-image # docker run -d é•œåƒåç§°
```

## æŸ¥çœ‹åœ¨è¿è¡Œçš„å®¹å™¨

```bash
docker ps
# or
docker ps -a
```

* ps è¡¨ç¤º process status
* -a äº§çœ‹å…¨éƒ¨ åŒ…æ‹¬æœªè¿è¡Œçš„å®¹å™¨

## ç«¯å£æ˜ å°„

å½“æˆ‘ä»¬è¿è¡Œèµ·å®¹å™¨åï¼Œæƒ³è¦åœ¨æœ¬åœ°è®¿é—®å‘ç°æ˜¯ä¸èƒ½æˆåŠŸçš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ Docker æœåŠ¡å™¨çš„ç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯å£æ‰èƒ½è¿›è¡Œè®¿é—®ã€‚

```bash
docker run -d -p 3000:3000 nodejs-image
```

* 3000:3000 ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£,è®¿é—®ä¸»æœºç«¯å£ 3000 çš„æ—¶å€™å°±ä¼šè®¿é—®å®¹å™¨ç«¯å£ 3000ã€‚ä½¿ç”¨å…¶ä»–ç«¯å£ä¹Ÿå¯ä»¥ï¼Œåªè¦ä¸å†²çªå°±å¥½ã€‚

## ç»™è¿™ä¸ªå®¹å™¨è‡ªå®šä¹‰ä¸€ä¸ªåå­—

å¦‚æœä¸å®šä¹‰é‚£ä¹ˆç³»ç»Ÿå°±ä¼šç»™å®¹å™¨éšæœºå®šä¹‰ä¸€ä¸ªåå­—

```bash
docker run -d -p 3000:3000 --name nodejs-container nodejs-image
```

## åœæ­¢è¿è¡Œå®¹å™¨(å…³æœº)

æŠŠä¸ä½¿ç”¨çš„å®¹å™¨åœæ­¢è¿è¡Œï¼Œä¹Ÿå°±å…³æœºï¼ŒèŠ‚çœèµ„æºã€‚

```bash
docker stop nodejs-container # å®¹å™¨çš„id æˆ–è€…æ˜¯å®¹å™¨çš„åå­—éƒ½å¯ä»¥
```

## åˆ é™¤å®¹å™¨

```bash
docker rm container_id/contanier_name
```

## å¼ºåˆ¶åˆ é™¤

```bash
docker rm -f container_id/contanier_name
```

## ä¿®æ”¹æœ¬åœ°æ–‡ä»¶ åŒæ­¥åˆ° docker æ–‡ä»¶

ä¿®æ”¹æœ¬åœ°æ–‡ä»¶åï¼Œdocker ä¸ä¼šè‡ªåŠ¨åŒæ­¥ï¼Œ é•œåƒå¦‚åŒä¸€å¼ ç…§ç‰‡ï¼Œåªä¿®æ”¹æ–‡ä»¶å¹¶æ²¡æœ‰ä¿®æ”¹é•œåƒï¼Œæ‰€ä»¥éœ€è¦ç”Ÿæˆæ–°çš„é•œåƒ

### æŸ¥çœ‹æˆ‘ä»¬æ­£åœ¨è¿è¡Œçš„å®¹å™¨

å¦‚ä½•è®¿é—®å®¹å™¨å‘¢ï¼Ÿ

```bash
docker exec -it nodejs-container /bin/sh
```

* exec ececute æ‰§è¡Œ
* i interactive äº¤äº’
* t pseudo-TTY ä¼ªç»ˆç«¯
* nodejs-container å®¹å™¨å
* /bin/sh è¡¨ç¤ºæˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªæ–°çš„ bash shell

æ‰§è¡Œåä¼šç›´æ¥è¿›å…¥æˆ‘çš„å·¥ä½œç›®å½• myDocker ä½¿ç”¨ `exit` é€€å‡º shell

### é”€æ¯å®¹å™¨

```bash
docker rm -f nodejs-container
```

### é‡æ–°å¼€å¯ä¸€ä¸ªå®¹å™¨ -v

```bash
docker run -d -v /Users/your_name/Desktop/learnDocker/:/myDocker -p 3000:3000 --name nodejs-container nodejs-image
```

* ç»å¯¹è·¯å¾„ æœ¬åœ°æ–‡ä»¶å¤¹è·¯å¾„ï¼šå®¹å™¨æ–‡ä»¶å¤¹è·¯å¾„ ï¼ˆ/Users/your_name/Desktop/learnDocker/:/myDockerï¼‰
* æœ¬åœ°æ–‡ä»¶å¤¹è·¯å¾„ä½¿ç”¨ `pwd` æŸ¥çœ‹æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡

### æ”¹åŠ¨åèƒ½å¦æˆåŠŸï¼Ÿ

è™½ç„¶æ–‡ä»¶å†…å®¹åŒæ­¥æ›´æ”¹äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸è¡Œ å› ä¸ºæ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨çš„æ—¶å€™ ä½¿ç”¨ node app.js æ˜¯æ ¹æ®æ‰§è¡Œæ˜¯çš„æœåŠ¡å™¨æ–‡ä»¶æ¥å¯åŠ¨æœåŠ¡çš„ã€‚
å¦‚æœæ–‡ä»¶æœ‰ä¿®æ”¹æˆ‘ä»¬éœ€è¦é‡æ–°æ‰§è¡Œ node app.js æ‰èƒ½æ˜¾ç¤ºæœ€æ–°çš„å†…å®¹ã€‚

### ä½¿ç”¨ nodemon æ¥è‡ªåŠ¨é‡å¯

* å†æ¬¡åˆ é™¤å®¹å™¨
* å®‰è£… nodemon

```bash
npm i nodemon -D
```

ä¿®æ”¹ package.json çš„è„šæœ¬

```json
"scripts": {
    "dev": "nodemon app.js"
}
```

### ä¿®æ”¹ Dockerfile

å°† `CMD ["node","app.js"]` æ”¹æˆ `CMD [ "npm","run","dev"]`

### åˆ é™¤ä¹‹å‰çš„é•œåƒ å¹¶é‡æ„é•œåƒ

### ä½¿ç”¨-v é€‰é¡¹å†æ¬¡å¯åŠ¨å®¹å™¨

```bash
docker run -d -v /Users/jiajunhua/Desktop/learnDocker/:/myDocker -p 3000:3000 --name nodejs-container nodejs-image
```

### ç‰¹æ®Šå¤„ç†

#### ä¸è¦åŒæ­¥çš„æ–‡ä»¶ node_modules

```bash
docker run -d -v /Users/jiajunhua/Desktop/learnDocker/:/myDocker -v /myDocker/node_modules -p 3000:3000 --name nodejs-container nodejs-image
```

* è¯´æ˜ ndoe_modules æ–‡ä»¶å¤¹ä¸è¿›è¡ŒåŒæ­¥

#### å®¹å™¨å†…å®¹ä¿®æ”¹ä¹Ÿä¼šå¯¼è‡´æœ¬åœ°å†…å®¹ä¿®æ”¹ è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„

æˆ‘ä»¬è¦è®©æœ¬åœ°å˜æˆåªè¯»æ¨¡å¼ readonly ä¹Ÿå°±æ˜¯ å®¹å™¨ä¿®æ”¹ä¸ä¼šå½±å“åˆ°æœ¬åœ°çš„å†…å®¹ å•é¡¹æµé€š åœ¨-v åé¢åŠ ä¸Šå†’å· ro :ro

```bash
docker run -d -v /Users/jiajunhua/Desktop/learnDocker/:/myDocker:ro -v /myDocker/node_modules -p 3000:3000 --name nodejs-container nodejs-image
```

#### ä½¿ç”¨ volume æ—¶ å½“åˆ é™¤å®¹å™¨çš„æ—¶å€™ æŠŠå¯¹åº”çš„ volume ä¹Ÿåˆ é™¤

```bash
docker rm -fv nodejs-container
```

## è§£å†³æ¯æ¬¡å†™å‘½ä»¤éƒ½å¾ˆé•¿çš„é—®é¢˜ docker-compose

```bash
touch docker-compose.yml # åˆ›å»º docker-compose.yml æ–‡ä»¶
```

```bash
version: '3.8'
services:
  nodejs-contaier:
build: .
ports:
  - "3000:3000"
volumes:
  - ./:/myDocker:ro
  - /myDocker/node_modules
```

æ³¨æ„è¿™é‡Œçš„ç¼©è¿›æ˜¯å¿…è¦çš„

## å¯åŠ¨ docker-compose

```bash
docker-compose up
docker-compose up -d  # -d åå°è¿è¡Œæ¨¡å¼
docker-compose up -d --build # --build  é•œåƒä¿®æ”¹å docker-compose è‡ªåŠ¨é‡å»º
```

## æ¸…é™¤ docker-compose

```bash
docker-compose down -y
```

## é¡¹ç›®ä»“åº“åœ°å€

[githubé¡¹ç›®åœ°å€](https://github.com/ajiafe/learn-docker)
